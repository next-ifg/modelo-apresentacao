% 
% NExT Beamer Theme
% 
% Autor: Pedro Maione [pedromaionee@gmail.com]
%
% Versão 1.1: 11/05/2017
%

\ProvidesPackage{beamerthemenext}[2017/05/11]

\newif\if@PaginaSecao
\@PaginaSecaofalse
\DeclareOption{nosectionpages}{\@PaginaSecaotrue}
\ProcessOptions

%% Utilização com pdflatex
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8x]{inputenc}

%% Utilização com xetex ou luatex
% \RequirePackage{fontspec}

\RequirePackage{eso-pic}
\RequirePackage[brazilian]{babel}
\RequirePackage{graphicx}
\RequirePackage{multicol}

%% 
\usepackage{tikz}
\usetikzlibrary{mindmap,backgrounds,positioning}

\mode<presentation>

% ---------------------------------------------------------------------
% Sumario (Table of Contents)
% ---------------------------------------------------------------------
\useoutertheme[subsection=false,shadow]{miniframes}
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

% ---------------------------------------------------------------------
% custom commands
% ---------------------------------------------------------------------
\newcommand{\IFG}{Instituto Federal de Educação, Ciência e Tecnologia de Goiás}
\newcommand{\setaDireita}{$\Rightarrow{}$}

% ---------------------------------------------------------------------
% Itemize
% ---------------------------------------------------------------------
\setbeamertemplate{itemize item}{\setaDireita}
\setbeamertemplate{itemize subitem}{\setaDireita}
\setbeamertemplate{itemize subsubitem}{\setaDireita}

\setlength{\parskip}{0.5em}

% ---------------------------------------------------------------------
% Paleta de Cores
% ---------------------------------------------------------------------

\definecolor[named]{corPrimaria}{HTML}{FF1D06}
\definecolor[named]{corPrimariaClaro}{HTML}{FF3B26}
\definecolor[named]{corPrimariaEscuro}{HTML}{C91B08}

\definecolor[named]{corSecund1}{HTML}{FF9206}
\definecolor[named]{corSecund1Claro}{HTML}{FFA126}
\definecolor[named]{corSecund1Escuro}{HTML}{C97508}

\definecolor[named]{corSecund2}{HTML}{0E65A3}
\definecolor[named]{corSecund2Claro}{HTML}{2478B4}
\definecolor[named]{corSecund2Escuro}{HTML}{0D5181}

\definecolor[named]{corSecund3}{HTML}{04C02E}
\definecolor[named]{corSecund3Claro}{HTML}{1ECC45}
\definecolor[named]{corSecund3Escuro}{HTML}{069826}

\definecolor[named]{corCinza}{HTML}{676767}
\definecolor[named]{corCinzaEscuro}{HTML}{262626}
\definecolor[named]{corCinzaClaro}{HTML}{A5A5A5}

% Geral
\setbeamercolor{normal text}{fg=black}
\setbeamercolor{structure}{fg=corCinza}
\setbeamercolor{alerted text}{fg=corPrimaria}
\setbeamercolor{example text}{fg=white}
\setbeamercolor{copyright text}{fg=corCinza}
\setbeamercolor{palette primary}{fg=corCinzaEscuro}
\setbeamercolor{palette secondary}{fg=black,bg=corCinzaClaro!25}
\setbeamercolor{palette tertiary}{fg=corPrimariaClaro,bg=corCinzaClaro!50}
\setbeamercolor{palette quaternary}{fg=white, bg=corCinzaEscuro!75}
% Titlepage
\setbeamercolor{title}{parent=normal text}
\setbeamercolor{subtitle}{parent=normal text}
\setbeamercolor{institute}{parent=normal text}
% Content
\setbeamercolor{frametitle}{parent=palette quaternary}
% Blocks
\setbeamercolor{block title}{parent=palette quaternary}
\setbeamercolor{block body}{parent=palette secondary}
\setbeamercolor{block title example}{fg=white, bg=corSecund3Escuro}
\setbeamercolor{block body example}{fg=corCinzaEscuro, bg=corSecund3Claro!50}
\setbeamercolor{block title alerted}{fg=white, bg=corPrimariaEscuro}
\setbeamercolor{block body alerted}{fg=corPrimaria, bg=corPrimaria!05}
% Notes
\setbeamercolor{note page}{fg=corCinzaEscuro,bg=corCinza}
\setbeamercolor{note title}{fg=white, bg=corCinzaEscuro}
\setbeamercolor{note date}{parent=note title}
% Page Number
\setbeamercolor{page number in head/foot}{fg=corCinzaEscuro}


% Fontes

% Titlepage
\setbeamerfont{title}{size=\fontsize{20}{20}}
\setbeamerfont{subtitle}{size=\fontsize{12}{14}}
\setbeamerfont{date}{size=\fontsize{8}{10}}
\setbeamerfont{author}{size=\fontsize{12}{15}}
\setbeamerfont{institute}{size=\fontsize{8}{10}}
% Section
\setbeamerfont{section title}{size=\LARGE}
% Content
\setbeamerfont{frametitle}{size=\large}
\setbeamerfont{copyright text}{size=\tiny}
\setbeamerfont{block title}{size=\large}
\setbeamerfont{block title example}{size=\large}
\setbeamerfont{block title alerted}{size=\large}
% Captions
\setbeamerfont{caption name}{family=\ttfamily}

% ---------------------------------------------------------------------
% Titlepage
% ---------------------------------------------------------------------

% Estrutura da capa (titlepage)
\def\maketitle{%
  \ifbeamer@inframe%
  \titlepage%
  \else%
  \frame[plain]{%
    \titlepage%
  }%
  \fi%
}%

\def\titlepage{\usebeamertemplate{title page}}

\setbeamertemplate{title page}
{
  \tikzstyle{caixa texto} = [minimum width=120mm,yshift=5mm, anchor=west]
  % Adiciona o background
  \tikz[remember picture, overlay]{%
    \node[opacity=1,inner sep=0pt] at (current page.center){%
      \includegraphics[width=\paperwidth,height=\paperheight]{./titlepage-bg-43.eps}%
    };%

    \node [yshift=-15mm] (banner) at (current page.north) {%
      \includegraphics[scale=1]{./titlepage-banner-43.eps}\par
    };

    \node  (titulo) [caixa texto,right=2.5mm of current page.west, yshift=5mm] {%
      % Insere titulo
      \ifx\insertsubtitle\@empty%
      \else%
      \parbox{100mm}{%
        \usebeamerfont{title}%
        \usebeamercolor[fg]{title}%
        \MakeUppercase{\inserttitle}\par
      }%
      \fi%
    };

    \node (subtitulo) [caixa texto,below=of titulo] {%
      % Insere subtitulo
      \ifx\insertsubtitle\@empty%
      \else%
      \parbox{100mm}{\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%
    };

    \node (data) [caixa texto,below=of subtitulo] {%
      % Insere Data
      \ifx\insertdate\@empty%
      \else%
      \parbox{100mm}{\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}%
      \fi% 
    };

    \node (autor) [caixa texto,below=of data, xshift=-20mm] {%
      % Insere Autor
      \ifx\insertauthor\@empty%
      \else%
      \parbox{60mm}{\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}%
      \fi%
    };

    \node (instituicao) [caixa texto,below=of autor] {%
      % Insere Instituto
      \ifx\insertinstitut\@empty%
      \else%
      \parbox{60mm}{\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}%
      \fi% 
    };
  }

}

% ---------------------------------------------------------------------
% Sectionpages
% ---------------------------------------------------------------------

% Converte o titulo de seção em caixa alta
\newcommand{\insertsectionHEAD}{%
  \expandafter\insertsectionHEADaux\insertsectionhead}
\newcommand{\insertsectionHEADaux}[3]{\MakeUppercase{#3}
}

\if@PaginaSecao\@empty
\else
% Insert um slide com o titulo da seção
\AtBeginSection[]{%
  \begingroup
  % \setbeamercolor{background canvas}{bg=corCinzaEscuro}
  \begin{frame}[plain]
    \tikz[remember picture, overlay]{%
      \node[opacity=1,inner sep=0pt] at (current page.center){%
        \includegraphics[width=\paperwidth,height=\paperheight]{./titlepage-bg-43.eps}%
      };%
      \node [yshift=20mm](titulo) at (current page.center) {%
        \parbox{120mm}{%
          \centering
          \usebeamerfont{section title}%
          \textcolor{corPrimariaEscuro}{%
            \insertsectionHEAD%
          }
        }%
      }
    }
  \end{frame}
  \endgroup
}
\fi

% \if@PaginaSecao\@empty
% \else
% % Insert um slide com o titulo da seção
% \AtBeginSection[]{%
%   \begingroup
%   \setbeamercolor{background canvas}{bg=corCinzaEscuro}
%   \begin{frame}[plain]
%     \centering
%     \vfill\usebeamerfont{section title}\textcolor{white}{\insertsectionHEAD}\vfill
%   \end{frame}
%   \endgroup
% }
% \fi

% ---------------------------------------------------------------------
% Frametitle
% ---------------------------------------------------------------------
\setbeamertemplate{frametitle}{%
  \begin{beamercolorbox}[%
    wd=\paperwidth,%
    leftskip=0.3cm,%
    rightskip=0.3cm,%
    ht=3ex,%
    dp=1.5ex%
    ]{frametitle}
    \usebeamerfont{frametitle}\MakeUppercase{\insertframetitle}%
  \end{beamercolorbox}
}

% ---------------------------------------------------------------------
% Footline
% ---------------------------------------------------------------------
\usenavigationsymbolstemplate{}
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[%
    wd=\textwidth,%
    ht=3ex,%
    dp=1.5ex,%
    leftskip=0.3cm,%
    rightskip=0.3cm%
    ]{structure}%
    \hfill\usebeamerfont{page number in head/foot}%
    \insertframenumber%
  \end{beamercolorbox}%
}

% ---------------------------------------------------------------------
% Captions
% ---------------------------------------------------------------------
\setbeamertemplate{caption label separator}{: }

% ---------------------------------------------------------------------
% Blocks
% ---------------------------------------------------------------------
\setbeamertemplate{block begin}
{
  \setbeamercolor{item}{parent=block body}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex]{block title}
    \usebeamerfont*{block title}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex,%
    vmode%
    ]{block body}%
  }
  \setbeamertemplate{block end}  
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
  \setbeamercolor{item}{parent=block body alerted}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex%
    ]{block title alerted}
    \usebeamerfont*{block title alerted}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex,%
    vmode%
    ]{block body alerted}%
  }
  \setbeamertemplate{block alerted end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex%
    ]{block title example}
    \usebeamerfont*{block title example}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex,%
    vmode%
    ]{block body example}%
  }
  \setbeamertemplate{block example end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\mode<all>
